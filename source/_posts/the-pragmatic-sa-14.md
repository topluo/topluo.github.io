title: 【系统架构师修炼之道】（14）：操作系统基础知识——同步和互斥
date: 2015-10-14 13:41:57
categories: 系统架构师修炼之道
tags:
---

## 原语
- P原语  Passeren(占有)，阻塞原语，负责把当前进程由运行状态转换为阻塞状态，操作为：申请一个空闲资源（把信号量减1），若成功，则退出；若失败，则该进程被阻塞；

- V原语 V是荷兰语Vrijgeven（释放）的首字母。为唤醒原语，负责把一个被阻塞的进程唤醒，它有一个参数表，存放着等待被唤醒的进程信息。操作为：释放一个被占用的资源（把信号量加1），如果发现有被阻塞的进程，则选择一个唤醒之。


PV操作对于每一个进程来说，都只能进行一次，而且必须成对使用。在PV原语执行期间不允许有中断的发生，根本原理是机器指令。

<!-- more -->

## 信号量

semaphore[英][ˈseməfɔ:(r)] 它负责协调各个线程, 以保证它们能够正确、合理的使用公共资源。


## 互斥和同步

- 同步是各个进程按照一定的顺序和速度执行，一种更加复杂的互斥，互斥是一种特殊的同步。互斥是两个任务之间不可以同时运行，同步也是不能同时运行，但他是必须要安照某种次序来运行相应的线程（也是一种互斥）

- 互斥是一组并发进程中的一个或多个程序段，因共享某一个共有资源，为了保证临界资源在某一时刻只能被一个进程访问，从而不允许交叉的顺序执行。

## 互斥原则

- 有空让进
- 忙则等待
- 多种选一 
- 有限等待
- 让权等待

## 临界区的访问过程

- 进入区:查看临界区是否可访问，如果可以访问，则转到步骤二，否则进程会被阻塞
- 临界区:在临界区做操作
- 退出区:清除临界区被占用的标志
- 剩余区：进程与临界区不相关部分的代码



### 实现互斥的方法

- 硬件实现方法 

进程之间的切换是通过CPU的中断完成，人为控制CPU的中断就可以保证当前进程顺利执行完，具体是：屏蔽中断->执行临界区->开中断，但是这样限制了CPU的交替执行任务的能力，并且将主动权交给用户，不灵活，不安全。

- 信号量实现方法

P和V操作分别来自荷兰语Passeren和Vrijgeven，分别表示占有和释放, 
信号量S的意义：S>=0 表示某资源的可用数，S<0 其绝对值表示阻塞队列中等待该资源的进程数。
P操作的定义：S:=S-1 若 S>=0 ,则P操作的进程继续执行，若S<0，则置该进程为阻塞状态(无可用资源),并将其插入阻塞队列。

```
Procedure P (Var S:Semaphore);
    Begin
      S:=S-1;
      If S<0 then W(S) ##执行P操作的进程插入到等待队列
    End;
```

V操作定义：S:=S+1，若S>0，则执行V操作的进程继续执行；否则若S<=0,则从阻塞状态唤醒一个进程，并将其插入就绪队列，然后执行V操作的进程继续执行。
```
Procedure V(Var S:Semaphore);
    Begin
       S:=S+1;
       If S<= then R(S) ##从阻塞队列中唤醒一个进程
    End;
```

### 同步互斥的模型

- 生产者消费者，是既同步又互斥的关系，只有生产者生产了，消费者才能消费是同步关系，但是他们对于临界区的访问又是互斥的。

- 读者写者问题，读者和写者互斥，写者和写者互斥，读者和读者不互斥。

- 哲学家进餐问题

---

感谢您的耐心阅读，如果您发现文章中有一些没表述清楚的，或者是不对的地方，请给我留言，你的鼓励是作者写作最大的动力，
如果您认为本文质量不错，读后觉得收获很大，不妨小额赞助我一下，让我更有动力继续写出高质量的文章。

- 支付宝 
![](http://7xjl4u.com1.z0.glb.clouddn.com/15-10-14/18963137.jpg)
- 微信 
![](http://7xjl4u.com1.z0.glb.clouddn.com/15-10-14/34122370.jpg)
   
作 者 : [@mousycoder](http://weibo.com/mousycoder)

原文出处 : http://mousycoder.com/2015/10/14/the-pragmatic-sa-14/

创作时间：2015-9-1

更新时间：2015-10-16
